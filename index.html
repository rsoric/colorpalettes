<!doctype html>
<html lang="en">

  <head>
  <style>

body{
    font-family:'Lucida Console', monospace;
    background-color: darkgray;
}
#data_vis{
          width:99%;
          display: flex;
          flex-direction: row;
          justify-content: center;
          margin-top:10px;

      }

#names{
    display:flex;
    flex-direction: row;
    width:1100px;
    text-align: center;
}

#names p{
    width: 169px;
    margin-right:10px;
}

#icon img{
    width:125px;
    padding-right:25px;
}

#header{
    display:flex;
    flex-direction: row;
    justify-content:center;
}

#select{
    display:flex;
    flex-direction: row;
    justify-content:center;
}
#secondaryCanvas{
    
}



  </style>
    <script src="https://d3js.org/d3.v3.min.js"></script>
<title>Color palettes on early computer systems</title>
<link rel="shortcut icon" type="image/png" href="img/icon.png"/>  
</head>
  
  <body>
      <div id="header">

        <div id="icon">
            <img src="img/icon.png">
        </div>

        <div id="titletext">
            <h1>Color palettes on early computer systems</h1>
            <h4>Robert Sorić • robert.soric@gmail.com • DRD • Made with D3.js</h4>
        </div>
   

      </div>

     
  <div id ="select">
    <label for="systems">Select a computer system: </label>

    <select name="systems" id="systems" onchange="loadPalette()">
    <option value="" selected disabled hidden> - </option>
      <option value="teletext">Teletext</option>
      <option value="appleii">Apple II</option>
      <option value="ibmpc">IBM PC</option>
      <option value="commodore64">Commodore 64</option>
      <option value="zxspectrum">ZX Spectrum</option>
    </select>
  </div>

  <canvas id="secondaryCanvas" width="300" height="300" style="border:1px solid #000000;">
   </canvas>

  <div id="data_vis">
    


  
  <script>




    function sortColors(colors)
    {
        colors.sort(function(a,b){
            return hexToHue(a) - hexToHue(b);
        });
    
    }

    
    function hexToHue(color)
    {
        let r = parseInt(color[0]+color[1],16);
        let g = parseInt(color[2]+color[3],16);
        let b = parseInt(color[4]+color[5],16);
    
        r /= 255;
        g /= 255;
        b /= 255;
    
        let cmin = Math.min(r,g,b),
            cmax = Math.max(r,g,b),
            delta = cmax - cmin,
            h = 0;
            if (delta == 0)
            h = 0;
        else if (cmax == r)
            h = ((g - b) / delta) % 6;
        else if (cmax == g)
            h = (b - r) / delta + 2;
        else
            h = (r - g) / delta + 4;
    
        h = Math.round(h * 60);
            
        if (h < 0)
            h += 360;
    
        return h;
    
    
    }

    let pixels = [];

    function getPixel(url, x, y) {
    var img = new Image();
    img.src = url;
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');
    context.drawImage(img, 0, 0);
    img.style.display = 'none';
    return context.getImageData(x, y, 1, 1).data;
    }

    function getPixelColorDataFromImage(url)
    {
        var img = new Image();
        img.crossOrigin = 'anonymous';
        img.src = url;
        var canvas = document.getElementById('secondaryCanvas');
        var ctx = canvas.getContext('2d');
        img.onload = function() {
        ctx.drawImage(img, 0, 0);

        pixels = [];

        var startx = 0,
            starty = 0,
            endx = 169,
            endy = 227;

            for (; startx <= endx; startx++) {
                for (starty = 0; starty <= endy; starty++) {
                    var pixel = ctx.getImageData(starty, endy, 1, 1);
                    console.log(pixel.data);
                }
            }

        };

        
    }
        
    
    var svg = d3.select("#data_vis")
        .append("svg")
        .attr("width",945)
        .attr("height",600);
    
    let teletextColors = [
        "0000ff",
        "ff0000",
        "ff00ff",
        "00ff00",
        "00ffff",
        "ffff00"
    ]
    
    let appleColors = [
        "6c2940",
        "403578",
        "d93cf0",
        "135740",
        "2697f0",
        "bfb4f8",
        "404b07",
        "d9680f",
        "808080",
        "eca8bf",
        "26c30f",
        "bfca87",
        "93d6bf"
    
    ]
    
    let commodoreColors = [   
        "eab489",
        "b86962",
        "782922",
        "87d6dd",
        "aa5fb6",
        "1a8226",
        "40318d",
        "bfce72"
    ]
    
    let ibmColors = [ 
        "55ff55",
        "ff5555",
        "ffff55"
    ]
    
    let commodore64Colors = [
        "883932",
        "67b6bd",
        "8b3f96",
        "55a049",
        "40318d",
        "bfce72",
        "8b5429",
        "574200",
        "b86962",
        "505050",
        "787878",
        "94e089",
        "7869c4",
        "9f9f9f"
    
    ]
    
    let zxSpectrumColors = [
        "0000c0",
        "c00000",
        "c000c0",
        "00c000",
        "00c0c0",
        "c0c000",
        "0000ff",
        "ff0000",
        "ff00ff",
        "00ff00",
        "00ffff",
        "ffff00"
    
    ]
    
    let colorPalettes = [
        teletextColors,
        appleColors,
        ibmColors,
        commodoreColors,
        commodore64Colors,
        zxSpectrumColors
    ]
    
    
    let imageDisplayed=false;
    
    margin = 10;
    
    let blockWidth = 1014/colorPalettes.length;

    let selectedPalette = 0;
    let selectedImageURL ="";


    function loadPalette() {
        

        let selectedPaletteName = document.getElementById("systems").value;

        if(selectedPaletteName == "teletext")
        {
            selectedPalette = teletextColors;
            selectedImageURL = "img/0.png";
        }

        else if(selectedPaletteName == "appleii")
        {
            selectedPalette = appleColors;
            selectedImageURL = "img/1.png";
        }

        else if(selectedPaletteName == "ibmpc")
        {
            selectedPalette = ibmColors;
            selectedImageURL = "img/2.png";
        }

        else if(selectedPaletteName == "commodore64")
        {
            selectedPalette = commodore64Colors;
            selectedImageURL = "img/4.png";
        }

        else if(selectedPaletteName == "zxspectrum")
        {
            selectedPalette = zxSpectrumColors;
            selectedImageURL = "img/5.png";
        }

        if(!imageDisplayed)
        {
            let myimage = svg.append('image').attr('xlink:href', selectedImageURL)
            .attr('width', 169)
            .attr('height', 227)
            .attr('x', 0)
            .attr('y', 0)
            .attr('class','parrotIMG').style("opacity", 0);

            document.getElementById("systems").disabled = true;

            myimage.transition().duration(2000).style("opacity", 1)
            imageDisplayed = true;

            

            setTimeout(() => {  


                document.getElementById("systems").disabled = false;
            

            }, 2005);

        }

        else
        {

            let myimageNew = svg.append('image').attr('xlink:href', selectedImageURL)
            .attr('width', 169)
            .attr('height', 227)
            .attr('x', 0)
            .attr('y', 0)
            .attr('class','parrotIMG').style("opacity", 0);

            document.getElementById("systems").disabled = true;

            myimageNew.transition().duration(2000).style("opacity", 1)

            setTimeout(() => {  

                let elements = document.getElementsByClassName('parrotIMG');
                
                while(elements.length > 1){
                    elements[0].parentNode.removeChild(elements[0]);
                    document.getElementById("systems").disabled = false;
                }

             }, 2005);

        }

    //Read pixels from image
    
    




    }

    getPixelColorDataFromImage(selectedImageURL);

    /*
    for (colorPalette in colorPalettes)
    {
        sortColors(colorPalettes[colorPalette]);
    
        let blockHeight = 400/colorPalettes[colorPalette].length;
        let currentX = blockWidth * colorPalette + margin*colorPalette;
        let currentY = 0;
        
        
    
            for (color in colorPalettes[colorPalette])
        {
            var myimage = svg.append('image')
            .attr('xlink:href', 'img/'+colorPalette+'.png')
            .attr('width', 169)
            .attr('height', 227)
            .attr('x', currentX)
            .attr('y', 0);
            
            svg.append("rect")
            .attr("x",currentX)
            .attr("y",(blockHeight*color)+227+10)
            .attr("width",blockWidth)
            .attr("height",blockHeight)
            .attr("style", "fill:#"+colorPalettes[colorPalette][color]+";")
            .on("mouseover", function(d) {				
                d3.select("#currentcolor").text(this.style.getPropertyValue("fill"));
                d3.select("#colordisplay").style('fill',this.style.getPropertyValue("fill"));	
                })					
            .on("mouseout", function(d) {		
                d3.select("#currentcolor").text('\u00A0');
                d3.select("#colordisplay").style('fill','lightgray');
            });;
        }
    
      
    
    
    }
    */
    
    
    
    
    
    
    
    
      </script>

<!--
<div id="colorinfo">
    <h3>Color:</h3>
    <h4 id="currentcolor">&nbsp;</h4>
    <svg width="155" height="541">
        <rect id="colordisplay" width="150" height="541" style="fill:lightgray;" />
      </svg>
</div>
</div>

<div id="names">
    <div>
        <p>Teletext</p>
        <p>1976</p>
    </div>
    <div>
        <p>Apple II</p>
        <p>1977</p>
    </div>
    <div>
        <p>IBM-PC</p>
        <p>1981</p>
    </div>
    <div>
        <p>Commodore VIC-20</p>
        <p>1981</p>
    </div>
    <div>
        <p>Commodore 64</p>
        <p>1982</p>
    </div>
    <div>
        <p>ZX Spectrum</p>
        <p>1982</p>
    </div>
-->

</div>
  </body>